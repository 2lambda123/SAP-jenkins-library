metadata:
  name: gradleExecuteBuild
  description: This step runs a gradle build command with parameters provided to the step.
  longDescription: This step runs a gradle build command with parameters provided to the step.
spec:
  inputs:
    secrets:
      - name: gradleSensitivePropertiesFileCredentialsId
        description: Jenkins credentails ID for gradle sensitive properties
        type: jenkins
    params:
      - name: path
        aliases:
          - name: buildGradlePath
            deprecated: false
        type: string
        description: Path to the folder with build.gradle (or build.gradle.kts) file which should be executed.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: false
      - name: tasks
        type: "[]string"
        description: Gradle tasks that should be executed.
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: false
        default: build
      - name: skipTasks
        type: "[]string"
        description: Gradle tasks that should be skipped while executing "tasks".
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        mandatory: false
      - name: repositoryUrl
        type: string
        description: Url to the repository to which the project artifacts should be published.
        scope:
          - GENERAL
          - PARAMETERS
          - STAGES
          - STEPS
        resourceRef:
          - name: commonPipelineEnvironment
            param: custom/repositoryUrl
      - name: repositoryPassword
        type: string
        description: Password for the repository to which the project artifacts should be published.
        scope:
          - GENERAL
          - PARAMETERS
          - STAGES
          - STEPS
        secret: true
        resourceRef:
          - name: commonPipelineEnvironment
            param: custom/repositoryPassword
      - name: repositoryUsername
        type: string
        description: Username for the repository to which the project artifacts should be published.
        scope:
          - GENERAL
          - PARAMETERS
          - STAGES
          - STEPS
        secret: true
        resourceRef:
          - name: commonPipelineEnvironment
            param: custom/repositoryUsername
      - name: gradlePropertiesFile
        type: string
        description: Path to the .properties file that should be used as project settings file.
        scope:
          - GENERAL
          - STEPS
          - STAGES
          - PARAMETERS
        aliases:
          - name: gradle/gradlePropertiesFile
        default: gradle.properties
      - name: gradleSensitivePropertiesFile
        type: string
        description: .properties file containing sensitive info e.g. credentials
        scope:
          - PARAMETERS
          - STAGES
          - STEPS
        secret: true
        resourceRef:
          - name: commonPipelineEnvironment
            param: custom/gradleSensitivePropertiesFile
          - name: gradleSensitivePropertiesFileCredentialsId
            type: secret
          - type: vaultSecretFile
            name: gradleSensitivePropertiesFileVaultSecretName
            default: gradle-sensitive-props
      - name: projectsCommonConfig
        description: |
          This config used to configure default values for each project/subproject.
          Available properties:


          - `pluginsList` - coma separated list of pluggins to apply (default values: java-library,jacoco)
          - `component` - component from which artifact will be published (default value: java)
          - `version` - common artifact version
          - `groupId` - artifact group Id
          - `publish` - set to true if artifacts should be published (default: false)
          - `createBOM` - set to true if bom file should be created (default: false)
          - `useDeclaredVersioning` - set to true to use declared versions otherwise resolved versions will be used


          Example:

          ```yaml
              projectsCommonConfig:
                pluginsList: java
                component: java
                useDeclaredVersioning: false
                publish: false
                version: 1.2.3
                createBOM: false
          ```
        aliases:
        - name: projectsCommon
        type: "map[string]interface{}"
        scope:
          - STAGES
          - STEPS
      - name: projectsCustomConfigs
        description: |
          This config is pretty similar to projectsCommonConfig but with ability to specify properties for each project independently
          Available properties:


          - `projectName` - this property clarifies project which should be configured with the following properties
          - `pluginsList` - coma separated list of pluggins to apply (default: java-library,jacoco)
          - `component` - component from which artifact will be published (default value: java)
          - `version` - project artifact version
          - `artifactId` - project artifact Id
          - `groupId` - project group Id
          - `publish` - set to true if project has to be published (default: false)
          - `createBOM` - set to true if bom file should be created for project (default: false)
          - `useDeclaredVersioning` - set to true to use declared versions for the project otherwise resolved versions will be used


          If no property specified then common property will be used.

          Example:

          ```yaml
              projectsCustomConfigs:
              - projectName: p1
                publish: false
              - projectName: p2
                pluginsList: java-platform
                component: javaPlatform
                publish: false
          ```

        aliases:
          - name: projectsCustom
        type: "[]map[string]interface{}"
        scope:
          - STAGES
          - STEPS
      - name: useWrapper
        type: bool
        description: If set to false all commands are executed using 'gradle', otherwise 'gradlew' is executed.
        scope:
          - STEPS
          - STAGES
          - PARAMETERS
        default: false
  outputs:
    resources:
      - name: reports
        type: reports
        params:
          - filePattern: "**/bom.xml"
            type: sbom
  containers:
    - name: gradle
      image: gradle:6-jdk11-alpine
